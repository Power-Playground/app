let E=0;function w(t,n){const i=`atom${++E}`,o={toString:()=>i};return typeof t=="function"?o.read=t:(o.init=t,o.read=s=>s(o),o.write=(s,e,r)=>e(o,typeof r=="function"?r(s(o)):r)),n&&(o.write=n),o}const _=Symbol(),p=t=>typeof(t==null?void 0:t.then)=="function";function S(t){let n,i;const o={getItem:(s,e)=>{var r,c;const a=l=>{if(l=l||"",n!==l){try{i=JSON.parse(l)}catch{return e}n=l}return i},u=(c=(r=t())==null?void 0:r.getItem(s))!=null?c:null;return p(u)?u.then(a):a(u)},setItem:(s,e)=>{var r;return(r=t())==null?void 0:r.setItem(s,JSON.stringify(e))},removeItem:s=>{var e;return(e=t())==null?void 0:e.removeItem(s)}};return typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(o.subscribe=(s,e,r)=>{if(!(t()instanceof window.Storage))return()=>{};const c=a=>{if(a.storageArea===t()&&a.key===s){let u;try{u=JSON.parse(a.newValue||"")}catch{u=r}e(u)}};return window.addEventListener("storage",c),()=>{window.removeEventListener("storage",c)}}),o}const v=S(()=>typeof window<"u"?window.localStorage:void 0);function b(t,n,i=v,o){const s=o==null?void 0:o.unstable_getOnInit,e=w(s?i.getItem(t,n):n);return e.onMount=c=>{s||c(i.getItem(t,n));let a;return i.subscribe&&(a=i.subscribe(t,c,n)),a},w(c=>c(e),(c,a,u)=>{const l=typeof u=="function"?u(c(e)):u;return l===_?(a(e,n),i.removeItem(t)):l instanceof Promise?l.then(m=>(a(e,m),i.setItem(t,m))):(a(e,l),i.setItem(t,l))})}const d=jotai.getDefaultStore(),f=b("ppd-edit-state-history",[]);function I(t,n,i){const o=d.get(f);if(t==="add"&&d.set(f,[{...n,time:Date.now()},...o]),t==="remove"){if(i===void 0)throw new Error("index is required when type is remove");d.set(f,[...o.slice(0,i),...o.slice(i+1)])}if(t==="replace"){if(i===void 0)throw new Error("index is required when type is replace");d.set(f,[...o.slice(0,i),{...n,time:Date.now()},...o.slice(i+1)])}}function h(){const[t,n]=jotai.useAtom(f),i=React.useCallback(e=>{n(r=>[e,...r])},[n]),o=React.useCallback(e=>{n(r=>[...r.slice(0,e),...r.slice(e+1)])},[n]),s=React.useCallback((e,r=t.length-1)=>{n(c=>[...c.slice(0,r),e,...c.slice(r+1)])},[t.length,n]);return{history:t,setHistory:n,addEditState:i,removeEditState:o,replaceEditState:s}}export{I as d,h as u};
