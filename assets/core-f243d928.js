import{j as e}from"./index-eb125c8a.js";import{E as N,v as _,c as R,m as v,T as $,U as I,x as z,o as L,M as T,R as D,P as q,i as A,y as F,F as H}from"./messenger-provider-d9b12058.js";import{N as C}from"./NotImplemented-0c459126.js";import"./copyToClipboard-445aa5b6.js";const U="ppd-bottom-status";function O(){const{plugins:r,...m}=React.useContext(N),x=React.useMemo(()=>r.filter(c=>{var t;return(t=c.editor)==null?void 0:t.statusbar}).flatMap(c=>{var t;return((t=c.editor)==null?void 0:t.statusbar)??[]}),[r]);return e.jsx("div",{className:`monaco-editor ${U}`,children:x.map((c,t)=>e.jsx(c,{...m},t))})}const W="/app/assets/PP_P-929f1e81.svg",S="ppd-left-bar";function Y(r){const{activePanel:m,togglePanel:x}=_(),{plugins:c}=React.useContext(N),t=React.useMemo(()=>c.filter(o=>{var d;return(d=o.editor)==null?void 0:d.leftbar}).flatMap(o=>{var d;return((d=o.editor)==null?void 0:d.leftbar)??[]}),[c]),u=React.useMemo(()=>t.filter(o=>o.placement===void 0||o.placement==="top"),[t]),h=React.useMemo(()=>t.filter(o=>o.placement==="bottom"),[t]),y=o=>o.map(({id:d,tooltip:p,placeholder:P,icon:b})=>{const n=e.jsx("button",{className:R({active:(m==null?void 0:m.id)===d}),onClick:()=>x(d),children:typeof b=="string"?e.jsx("span",{className:`cldr codicon codicon-${b}`}):b},d),w=typeof p=="string"&&P?{contentText:p,contentPlaceholder:P}:{content:p};return p&&P?e.jsx($,{placement:"right",offset:[0,8],...w,children:n},d):n});return e.jsxs("div",{className:R(S,r.className),style:r.style,children:[e.jsxs("div",{className:`${S}__top`,children:[y(u),e.jsx("button",{onClick:()=>v.then(o=>o.display("warning",e.jsx(C,{}))),children:e.jsx("span",{className:"cldr codicon codicon-heart"})}),e.jsx("button",{onClick:()=>v.then(o=>o.display("warning",e.jsx(C,{}))),children:e.jsx("span",{className:"cldr codicon codicon-source-control"})}),e.jsx("button",{onClick:()=>v.then(o=>o.display("warning",e.jsx(C,{}))),children:e.jsx("span",{className:"cldr codicon codicon-book"})}),e.jsx("button",{onClick:()=>v.then(o=>o.display("warning",e.jsx(C,{}))),children:e.jsx("span",{className:"cldr codicon codicon-extensions"})})]}),e.jsxs("div",{className:`${S}__bottom`,children:[y(h),e.jsx("button",{onClick:()=>v.then(o=>o.display("warning",e.jsx(C,{}))),children:e.jsx("span",{className:"cldr codicon codicon-account"})}),e.jsx("button",{onClick:()=>v.then(o=>o.display("warning",e.jsx(C,{}))),children:e.jsx("span",{className:"cldr codicon codicon-gear"})}),e.jsx("img",{src:W,alt:"Power Playground menu icon."})]})]})}const Z="ppd-top-bar";function G({className:r}){const{plugins:m,...x}=React.useContext(N),c=React.useMemo(()=>m.filter(t=>{var u;return(u=t.editor)==null?void 0:u.topbar}).flatMap(t=>{var u;return((u=t.editor)==null?void 0:u.topbar)??[]}),[m]);return e.jsx("div",{className:R(Z,r),children:c.map((t,u)=>e.jsx(t,{...x},u))})}const M="ppd-editor-zone";function ee(r){const{enableMenuSwitch:m=!0}=r,x=React.useRef(new URLSearchParams(location.search)),c=React.useMemo(()=>jotai.createStore(),[]),[t,u]=React.useState(null),h=React.useMemo(()=>Object.values(r.plugins??{}).filter(s=>!!s),[r.plugins]),y=h.reduce((s,a)=>{var i,l;return{...s,...(l=(i=a.editor)==null?void 0:i.use)==null?void 0:l.reduce((g,j)=>({...g,...j==null?void 0:j({searchParams:x.current,editor:t})}),{})}},{}),{code:o,setCode:d,loadingNode:p,curFilePath:P,language:b}=y;if(d===void 0)throw new Error("You must register a plugin to provide `setCode` function");const n=I();React.useEffect(()=>{if(!n)return;const s=h.map(a=>{var i,l;return(l=(i=a==null?void 0:a.editor)==null?void 0:i.preload)==null?void 0:l.call(i,n,c)});return()=>s.forEach(a=>a==null?void 0:a())},[n,h,c]),React.useEffect(()=>{if(!n||!t)return;const s=t;try{n.editor.addKeybindingRule({keybinding:n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KeyP,command:"editor.action.quickCommand"})}catch(a){console.error(a);const i=s._standaloneKeybindingService.getKeybindings(),l=i.findIndex(g=>g.command==="editor.action.quickCommand");l!==-1&&i.splice(l,1),s._standaloneKeybindingService.addDynamicKeybinding("editor.action.quickCommand",n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KeyP,()=>{t.trigger("whatever","editor.action.quickCommand",{})})}},[t,n]),h.forEach(s=>{var a,i;return(i=(a=s==null?void 0:s.editor)==null?void 0:a.useShare)==null?void 0:i.call(a,y,n)});const[w,E]=React.useState("light");React.useEffect(()=>onThemeChange(E),[]);const[f,K]=jotai.useAtom(z),B=React.useRef(null);return React.useEffect(()=>{if(t)return t.setPosition(B.current??{lineNumber:1,column:1}),t.focus(),()=>{B.current=t.getPosition()??null}},[b,t]),React.useEffect(()=>{if(!n||!t)return;const s=h.map(a=>{var l,g;const i=(g=(l=a==null?void 0:a.editor)==null?void 0:l.load)==null?void 0:g.call(l,t,n);if(typeof i=="function")return i;if(Array.isArray(i))return i.reduce((j,k)=>()=>(j==null||j(),k==null?void 0:k()),()=>{})});return()=>s.forEach(a=>a==null?void 0:a())},[n,t,h]),L("keydown",s=>{s.key==="\\"&&(s.metaKey||s.ctrlKey)&&K(!f)}),e.jsx(N.Provider,{value:{searchParams:x.current,plugins:h,shareState:y},children:e.jsx(T.Provider,{value:{monaco:n,editorInstance:t,store:{code:[o,d],theme:[w,E]}},children:e.jsx(jotai.Provider,{store:c,children:e.jsxs(D,{className:R(M,r.className),style:{...r.style,"--border-scale":5,width:"var(--editor-width, 50%)",minWidth:"var(--editor-min-width)",maxWidth:"var(--editor-max-width)",height:"var(--editor-height, 50%)",minHeight:"var(--editor-min-height)",maxHeight:"var(--editor-max-height)"},resizable:r.resizable??{right:!0},onBorderBtnClick:r.onBorderBtnClick,onResized:s=>localStorage.setItem("zone-width",s.style.width),children:[m&&e.jsx(q,{placement:"right",className:R(`${M}__menu-switch`,{"is-active":f}),content:e.jsxs(e.Fragment,{children:[f?"Hide activity bar":"Show activity bar",e.jsx("br",{}),e.jsxs("kbd",{children:[A?"âŒ˜":"Ctrl"," + \\"]})]}),onClick:()=>K(!f),children:e.jsx("span",{className:R("cldr codicon",f?"codicon-menu":"codicon-layout-activitybar-left")})}),e.jsx(Y,{style:{width:f?void 0:0,padding:f?void 0:0}}),e.jsx(F,{}),e.jsxs("div",{className:`${M}__container`,children:[e.jsx(G,{className:m&&f?"is-active":void 0}),p??e.jsx(H,{language:b,options:{automaticLayout:!0,scrollbar:{vertical:"hidden",verticalSliderSize:0,verticalScrollbarSize:0}},theme:w==="light"?"vs":"vs-dark",loading:p,path:`file://${P}`,value:o,onChange:s=>d(s??""),onMount:s=>(u(s),s.focus())}),e.jsx(O,{})]})]})})})})}function te(r){return r??{}}export{ee as E,te as d};
