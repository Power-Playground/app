import{j as t,d as O}from"../../../index-eb125c8a.js";import{s as P,D as K,m as A,R as U,c as C,f as F,w as W,P as z,i as B}from"../../../messenger-provider-d9b12058.js";import{M as V}from"../../../Menu-da536cc5.js";import{u as $}from"../../../store-41053753.js";const q=React.forwardRef(function({code:f,onChange:r},u){const[d,D]=React.useState("light");React.useEffect(()=>onThemeChange(D),[]);const{history:v,removeEditState:N}=$();function M(e){const o=v.findIndex(s=>s.time===e);o!==-1&&N(o)}const[_,X]=React.useState(""),[a,j]=React.useState([void 0,void 0]),n=React.useMemo(()=>v.filter(e=>e.code.includes(_)&&(a[0]===void 0?!0:e.time>=a[0])&&(a[1]===void 0?!0:e.time<=a[1])),[a,v,_]),w=React.useRef([]),h=React.createRef(),[p,I]=React.useState(0),l=React.useCallback(e=>{I(s=>{const c=typeof e=="function"?e(s):e;return P(w.current[c>s?Math.min(c+1,n.length-1):Math.max(c-1,0)]),c})},[n.length]),[g,b]=[React.useCallback(()=>{l(e=>(e+n.length-1)%n.length)},[l,n]),React.useCallback(()=>{l(e=>(e+1)%n.length)},[l,n])],m=React.useMemo(()=>n[p],[n,p]);React.useImperativeHandle(u,()=>({open:()=>{var e;return(e=h.current)==null?void 0:e.open()},hide:()=>{var e;return(e=h.current)==null?void 0:e.hide()}}),[h]);const[L,R]=React.useState([]),[k,T]=React.useState("only-code"),S=React.useMemo(()=>({height:"calc(100% - 37px)",width:"100%",theme:d==="light"?"vs":"vs-dark",language:"typescript",options:{readOnly:!0,minimap:{enabled:!1},scrollbar:{vertical:"hidden"}}}),[d]);return t.jsxs(K,{ref:h,className:"history",style:{"--width":"80vw"},title:t.jsx(t.Fragment,{children:"History"}),binding:e=>e.key==="h"&&(e.metaKey||e.ctrlKey),handleKeyUpOnOpen:(e,o)=>{var s;e.key==="ArrowUp"&&e.ctrlKey&&l(0),e.key==="ArrowDown"&&e.ctrlKey&&l(n.length-1),e.key==="Enter"&&(r==null||r(m),(s=o==null?void 0:o.hide)==null||s.call(o)),e.key==="Backspace"&&A.then(c=>c.display("warning",t.jsxs(t.Fragment,{children:["Not implemented yet, it will come soon, ",t.jsx("a",{href:"https://github.com/Power-Playground/app/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22",target:"_blank",rel:"noreferrer",children:"help us"})]})))},handleKeyDownOnOpen:e=>{e.key==="ArrowUp"&&g(),e.key==="ArrowDown"&&b()},children:[t.jsxs(U,{className:"history__list",style:{width:"45%",minWidth:"40%",maxWidth:"80%"},resizable:{right:!0},children:[t.jsxs("div",{className:"ppd-search-box",onKeyUp:e=>e.stopPropagation(),children:[t.jsxs("span",{className:"opts",children:[t.jsx("button",{onClick:g,onDoubleClick:()=>l(0),children:t.jsx("kbd",{children:"â†‘"})}),t.jsx("button",{onClick:b,onDoubleClick:()=>l(n.length-1),children:t.jsx("kbd",{children:"â†“"})})]}),t.jsx("input",{type:"text",placeholder:"Search by code content",value:_,onChange:e=>X(e.target.value)}),t.jsxs("span",{className:"opts",children:[t.jsx("input",{type:"date",value:a[0]?new Date(a[0]).toISOString().slice(0,10):0,onChange:e=>j([new Date(e.target.value).getTime(),a[1]])}),t.jsx("input",{type:"date",value:a[1]?new Date(a[1]).toISOString().slice(0,10):0,onChange:e=>j([a[0],new Date(e.target.value).getTime()])})]})]}),t.jsx("div",{className:"history__list-items",children:n.map((e,o)=>t.jsxs("div",{ref:s=>{w.current[o]=s,s&&s.addEventListener("wheel",c=>{c.deltaX!==0&&c.preventDefault()},{passive:!1})},className:C("history__item",o===p&&"history__item--selected",L.includes(o)&&"history__item--swiped"),onClick:()=>l(o),onDoubleClick:()=>{var s;r==null||r(e),(s=h.current)==null||s.hide()},onWheel:s=>{if(o===p||Math.abs(s.deltaY)>5)return;const c=100,E=s.deltaX,i=w.current[o];if(!(Math.abs(s.deltaX)<5&&(!i.classList.contains("history__item--swiping")||!i.classList.contains("history__item--swiped")))){if(i.clearSwipingTimer&&clearTimeout(i.clearSwipingTimer),i.moveX===void 0&&(i.moveX=0),i.moveX+=E,i.moveX>0&&(i.moveX=0),i.moveX<-c&&(i.moveX=-c),i.style.setProperty("--swipe-start-offset-x",`${i.moveX}px`),i.moveX===0){R(x=>[...x,o]),i.classList.remove("history__item--swiping");return}if(i.moveX===-c){R(x=>x.filter(H=>H!==o)),i.classList.remove("history__item--swiping");return}i.classList.add("history__item--swiping"),i.clearSwipingTimer=setTimeout(()=>{i.classList.remove("history__item--swiping")},100)}},children:[t.jsx("pre",{className:"history__item__code",children:e.code}),t.jsx("div",{className:"history__item__time",children:new Date(e.time).toLocaleString()}),t.jsxs("div",{className:"history__item__tooltip",children:[t.jsxs("div",{className:"enter",children:["use by Â ",t.jsx("kbd",{onClick:()=>{var s;r==null||r(e),(s=h.current)==null||s.hide()},children:"â†µ"})]}),t.jsxs("div",{className:"delete",children:["delete by Â ",t.jsx("kbd",{onClick:()=>{M(e.time)},children:"âŒ«"})]})]})]},e.time))})]}),t.jsxs("div",{className:"preview",onKeyUp:e=>e.stopPropagation(),children:[t.jsx("div",{className:"toolbar",children:t.jsx(V,{className:"view-mode-menu button",items:[{id:"only-code",title:"Only display code"},{id:"diff-code",title:"Display code diff with current code"}],onSelect:({id:e})=>T(e),children:"ðŸ‘€ Change View Mode"})}),k==="only-code"&&t.jsx(F,{value:(m==null?void 0:m.code)??"",...S}),k==="diff-code"&&t.jsx(W,{modified:f??"",original:(m==null?void 0:m.code)??"",...S})]})]})}),Y=({shareState:y})=>{const{code:f,setCode:r}=y,u=React.useRef(null);return t.jsxs(t.Fragment,{children:[t.jsx(q,{ref:u,code:f,onChange:d=>r==null?void 0:r(d.code)}),t.jsx(z,{style:{cursor:"pointer"},offset:[0,2],content:t.jsxs(t.Fragment,{children:["Show History Â Â ",t.jsxs("kbd",{children:[B?"âŒ˜":"Ctrl"," + H"]})]}),onClick:()=>{var d;return(d=u.current)==null?void 0:d.open()},children:t.jsx("div",{className:"cldr codicon codicon-history"})})]})},te=O("history-for-local",y=>({editor:{statusbar:[Y]}}));export{te as _};
